svgEditor.addExtension("Arrows",function(e){function t(e,t){c=!0,g=v+t+"_",k.fw.id=g+"fw",k.bk.id=g+"bk"}function r(){c=!1,g=v,k.fw.id=g+"fw",k.bk.id=g+"bk"}function n(t,r){var n=t.getAttribute(r);if(!n)return null;var a=n.match(/\(\#(.*)\)/);return a&&2===a.length?e.getElem(a[1]):null}function a(e){if($("#arrow_panel").toggle(e),e){var t,r=f[0],n=r.getAttribute("marker-end"),a=r.getAttribute("marker-start"),i=r.getAttribute("marker-mid");n&&a?t="both":n?t="end":a?t="start":i&&(t="mid",-1!=i.indexOf("bk")&&(t="mid_bk")),a||i||n||(t="none"),$("#arrow_list").val(t)}}function i(){var e=f[0];e.removeAttribute("marker-start"),e.removeAttribute("marker-mid"),e.removeAttribute("marker-end")}function o(t,r,n){n=n||g+t;var a=e.getElem(n),i=k[t];if("mid"==r&&(i.refx=5),!a){a=s({element:"marker",attr:{viewBox:"0 0 10 10",id:n,refY:5,markerUnits:"strokeWidth",markerWidth:5,markerHeight:5,orient:"auto",style:"pointer-events:none"}});var o=s({element:"path",attr:{d:i.d,fill:"#000000"}});a.appendChild(o),e.findDefs().appendChild(a)}return a.setAttribute("refX",i.refx),a}function l(){var t=this.value;if(i(),"none"!=t){var r="fw";"mid_bk"==t?(t="mid",r="bk"):"both"==t?(o("bk",t),svgCanvas.changeSelectedAttribute("marker-start","url(#"+k.bk.id+")"),t="end",r="fw"):"start"==t&&(r="bk"),o(r,t),svgCanvas.changeSelectedAttribute("marker-"+t,"url(#"+k[r].id+")"),e.call("changed",f)}}function d(t){var r=t.getAttribute("stroke"),a=["start","mid","end"],i=e.findDefs();$.each(a,function(l,d){var f=n(t,"marker-"+d);if(f){var s=$(f).children().attr("fill"),m=$(f).children().attr("d"),c=null;if(s!==r){var u=$(i).find("marker");if(u.each(function(){var e=$(this).children().attr(["fill","d"]);e.fill===r&&e.d===m&&(c=this)}),!c){var v=f.id,k=-1!==v.indexOf("_fw")?"fw":"bk";c=o(k,d,g+k+u.length),$(c).children().attr("fill",r)}$(t).attr("marker-"+d,"url(#"+c.id+")");var b=!0;$(e.svgcontent).find("line, polyline, path, polygon").each(function(){var e=this;return $.each(a,function(t,r){return $(e).attr("marker-"+r)==="url(#"+f.id+")"?b=!1:void 0}),b?void 0:!1}),b&&$(f).remove()}}})}var f,s=(e.svgcontent,e.addSvgElementFromJson),m=e.nonce,c=e.randomize_ids;svgCanvas.bind("setnonce",t),svgCanvas.bind("unsetnonce",r);var u={en:[{id:"arrow_none",textContent:"No arrow"}],fr:[{id:"arrow_none",textContent:"Sans fl√®che"}]},v="se_arrow_";if(c)var g=v+m+"_";else var g=v;var k={fw:{d:"m0,0l10,5l-10,5l5,-5l-5,-5z",refx:8,id:g+"fw"},bk:{d:"m10,0l-10,5l10,5l-5,-5l5,-5z",refx:2,id:g+"bk"}};return{name:"Arrows",context_tools:[{type:"select",panel:"arrow_panel",title:"Select arrow type",id:"arrow_list",options:{none:"No arrow",end:"----&gt;",start:"&lt;----",both:"&lt;---&gt;",mid:"--&gt;--",mid_bk:"--&lt;--"},defval:"none",events:{change:l}}],callback:function(){$("#arrow_panel").hide(),$("#arrow_list option")[0].id="connector_no_arrow"},addLangData:function(e){return{data:u[e]}},selectedChanged:function(e){f=e.elems;for(var t=f.length,r=["line","path","polyline","polygon"];t--;){var n=f[t];n&&-1!=$.inArray(n.tagName,r)?e.selectedElement&&!e.multiselected?a(!0):a(!1):a(!1)}},elementChanged:function(e){var t=e.elems[0];t&&(t.getAttribute("marker-start")||t.getAttribute("marker-mid")||t.getAttribute("marker-end"))&&d(t)}}});